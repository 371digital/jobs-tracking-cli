{"version":3,"file":"index.js","names":["Change","props","change","bind","create","command","builder","describe","handler","links","map","link","id","uuid","key","RegExp","url","finedConfig","linkMarckupFields","find","marckupField","pattern","createValuePattern","value","match","hasField","fieldConfig","reduce","prompts","getMarckupField","push","message","name","title","type","answers","newLinks","forEach","answer","length","replace","Array","isArray","generateIds","getPrompts","inquirer","prompt","editMarckupValuesForLinks","content","projectConfig","request","post","project","projectId","media","validateAuth","getProjectConfig","prepareLinks","getChangeContent","startSpinner","createChange","then","res","isSuccessResponse","clearSpinner","clearSpinnerWithError","data","BaseCommand"],"sources":["../../../../source/commands/create/change/index.js"],"sourcesContent":["import {BaseCommand, request} from 'services';\nimport {linkMarckupFields} from '_constants';\nimport inquirer from 'inquirer';\nimport 'colors';\n\nclass Change extends BaseCommand {\n  constructor(props) {\n    super(props);\n    this.change = this.change.bind(this);\n\n    this.create({\n      command: 'change',\n      builder: {},\n      describe: 'Use for add changes to the project.',\n    });\n    this.handler(this.change);\n  }\n\n  generateIds(links) {\n    return links.map(link => {\n      link.id = this.uuid();\n      return link;\n    });\n  }\n\n  createValuePattern(key) {\n    return new RegExp(`{{${key}}}`);\n  }\n\n  getMarckupField(url) {\n    const finedConfig = linkMarckupFields.find(marckupField => {\n      const pattern = this.createValuePattern(marckupField.value);\n      return url.match(pattern) !== null;\n    });\n\n    return {\n      hasField: !!finedConfig,\n      fieldConfig: finedConfig || {},\n    };\n  }\n\n  getPrompts(links) {\n    return links.reduce((prompts, link) => {\n      const {hasField, fieldConfig} = this.getMarckupField(link.url);\n      if (hasField) {\n        prompts.push({\n          message: `Please enter ${fieldConfig.name} for ${link.title} :`,\n          type: 'string',\n          name: link.id,\n        });\n      }\n  \n      return prompts;\n    }, []);\n  }\n\n  editMarckupValuesForLinks(answers, links) {\n    const newLinks = [];\n    links.forEach(link => {\n      const answer = answers[link.id];\n      if (typeof answer === 'undefined') {\n        newLinks.push(link);\n        return;\n      }\n      if (answer.length) {\n        const {fieldConfig} = this.getMarckupField(link.url);\n        link.url = link.url.replace(\n          this.createValuePattern(fieldConfig.value),\n          answer,\n        );\n        newLinks.push(link);\n      }\n    });\n    return newLinks;\n  }\n\n  async prepareLinks(links) {\n    if (!Array.isArray(links)) return;\n    links = this.generateIds(links);\n    const prompts = this.getPrompts(links);\n    const answers = await inquirer.prompt(prompts);\n    return this.editMarckupValuesForLinks(answers, links);\n  }\n\n  async getChangeContent() {\n    const answers = await inquirer.prompt({\n      message: `Please enter your message :`,\n      type: 'string',\n      name: 'content',\n    });\n    return answers.content;\n  }\n\n  async createChange(projectConfig) {\n    return await request.post('/changes/createChange', {\n      type: projectConfig.type,\n      project: projectConfig.projectId,\n      content: projectConfig.content,\n      links: projectConfig.links,\n      media: projectConfig.media,\n    });\n  }\n\n  async change() {\n    this.validateAuth();\n    const projectConfig = this.getProjectConfig();\n    projectConfig.links = await this.prepareLinks(projectConfig.links);\n    projectConfig.content = await this.getChangeContent();\n    this.startSpinner('Create Change Start!');\n    await this.createChange(projectConfig).then(res => {\n      if (this.isSuccessResponse(res)) {\n        this.clearSpinner('Create Change Success!');\n      } else {\n        this.clearSpinnerWithError(`Create Change Error: ${res.data.message}`);\n      }\n    });\n  }\n}\nexport default new Change();\n"],"mappings":"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"}