{"version":3,"file":"index.js","names":["Tools","replace","c","r","Math","random","v","toString","text","spinner","ora","start","message","succeed","fail","process","exit","response","data","code","startSpinner","password","localStorage","getItem","clearSpinnerWithError","clearSpinner","filePath","content","Promise","resolve","fs","writeFile","error","path","rawData","readFileSync","JSON","parse","join","cwd","projectConfigPath","getProjectConfigPath","existsSync","readJsonFile","request","then","res","isSuccessResponse","id","type","projectConfig","projectId","media","links","stringify"],"sources":["../../source/tools/index.js"],"sourcesContent":["import ora from 'ora';\nimport {request, localStorage} from 'services';\nimport path from 'path';\nimport fs from 'fs';\n\nclass Tools {\n  uuid() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(\n      /[xy]/g,\n      function (c) {\n        var r = (Math.random() * 16) | 0,\n          v = c == 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n      },\n    );\n  }\n\n  startSpinner(text) {\n    this.spinner = ora(text).start();\n  }\n\n  clearSpinner(message) {\n    this.spinner.succeed(message);\n  }\n\n  clearSpinnerWithError(message) {\n    this.spinner.fail(message);\n    process.exit(-1)\n  }\n\n  isSuccessResponse(response) {\n    return response.data.code === 200;\n  }\n\n  validateAuth() {\n    this.startSpinner('Login check started!');\n    const password = localStorage.getItem('password');\n    if (!password) {\n      this.clearSpinnerWithError('Login required, please login!');\n    }\n    this.clearSpinner('Login check success!');\n  }\n\n  async writeFile(filePath, content) {\n    return await new Promise(async resolve => {\n      fs.writeFile(filePath, content, error => {\n        if (error) {\n          this.clearSpinnerWithError(error);\n          process.exit(1);\n        }\n        resolve(true);\n      });\n    });\n  }\n\n  readJsonFile(path) {\n    const rawData = fs.readFileSync(path);\n    return JSON.parse(rawData);\n  }\n\n  getProjectConfigPath() {\n    return path.join(process.cwd(), 'project.json');\n  }\n\n  getProjectConfig() {\n    this.startSpinner('Start getting project config!');\n    const projectConfigPath = this.getProjectConfigPath();\n    if (!fs.existsSync(projectConfigPath)) {\n      this.clearSpinnerWithError(\n        'Project config file not found, please start `create project` command',\n      );\n    }\n    this.clearSpinner('Getting project config success!');\n    return this.readJsonFile(projectConfigPath);\n  }\n\n  async getProjects() {\n    return await request('projects/getProjects').then(res => {\n      if (this.isSuccessResponse(res)) {\n        return res.data.data;\n      }\n    });\n  }\n\n  async createProjectConfig({id, type}) {\n    this.startSpinner('Start project.json create!');\n    const projectConfig = {\n      projectId: id,\n      media: [],\n      type: type,\n      links: [],\n    };\n    await this.writeFile(\n      this.getProjectConfigPath(),\n      JSON.stringify(projectConfig),\n    );\n    this.clearSpinner('Finish project.json creation!');\n  }\n}\nexport default Tools;\n"],"mappings":"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"}